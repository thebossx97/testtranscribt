<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Local browser-based audio transcription using Whisper AI. Upload files or capture screen/tab audio.">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; connect-src 'self' https://huggingface.co https://cdn-lfs.huggingface.co https://cdn.jsdelivr.net blob:; worker-src 'self' blob:; child-src 'self' blob:;">
    <title>Local Whisper Transcriber</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<!-- Startup Loading Screen -->
<div id="startupScreen" class="startup-screen">
    <div class="startup-content">
        <div class="startup-logo">
            <h1>üéß Local Whisper Transcriber</h1>
            <p class="startup-subtitle">Loading AI Models...</p>
        </div>
        
        <div class="startup-progress-container">
            <div id="startupModelName" class="startup-model-name">Initializing...</div>
            
            <div class="startup-progress-bar">
                <div id="startupProgressFill" class="startup-progress-fill"></div>
            </div>
            
            <div id="startupProgressText" class="startup-progress-text">Preparing to download models...</div>
            
            <div id="startupModelList" class="startup-model-list">
                <div class="model-item" id="modelTiny">
                    <span class="model-icon">‚è≥</span>
                    <span class="model-label">Tiny Model (~40MB)</span>
                    <span class="model-status">Waiting...</span>
                </div>
                <div class="model-item" id="modelBase">
                    <span class="model-icon">‚è≥</span>
                    <span class="model-label">Base Model (~75MB)</span>
                    <span class="model-status">Waiting...</span>
                </div>
                <div class="model-item" id="modelSmall">
                    <span class="model-icon">‚è≥</span>
                    <span class="model-label">Small Model (~250MB)</span>
                    <span class="model-status">Waiting...</span>
                </div>
            </div>
            
            <div class="startup-info">
                <p>First-time setup: Downloading ~365MB of AI models</p>
                <p>This takes 3-5 minutes but only happens once</p>
                <p>All models will be cached for instant future use</p>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <header>
        <h1>üéß Local Whisper Transcriber</h1>
        <p class="subtitle">File upload + experimental screen/tab audio capture, all transcribed locally in your browser.</p>
    </header>

    <div class="layout">
        <div class="panel">
            <h2>Transcript</h2>

            <div id="alert" class="alert"></div>

            <div class="control-group">
                <div class="model-selector">
                    <label for="modelSelect" style="font-size: 13px; color: var(--color-gray-400); margin-right: 6px;">
                        Model:
                    </label>
                    <select id="modelSelect">
                        <option value="Xenova/whisper-tiny.en">Tiny (~40MB, fastest, English)</option>
                        <option value="Xenova/whisper-base.en" selected>Base (~75MB, balanced, English)</option>
                        <option value="Xenova/whisper-small">Small (~250MB, accurate, multi-lang)</option>
                    </select>
                </div>
                <span class="badge">Runs 100% in browser</span>
            </div>

            <div id="status" class="status">
                <div class="status-dot"></div>
                <span id="statusText">Initializing...</span>
                <button id="loadModelBtn" class="btn btn-secondary" style="margin-left: auto; display: none;">Load Model</button>
            </div>
            
            <div id="progressBar" style="display:none; margin-bottom: 12px; background: rgba(0,0,0,0.1); border-radius: 4px; height: 12px; overflow: hidden; width: 100%;">
                <div id="progressFill" style="height: 100%; background: linear-gradient(90deg, var(--color-teal-500), var(--color-teal-600)); width: 0%; transition: width 0.3s ease;"></div>
            </div>

            <div class="control-group">
                <button id="copyBtn" class="btn btn-secondary" disabled>üìã Copy text</button>
                <button id="downloadBtn" class="btn btn-secondary" disabled>‚¨áÔ∏è Save as .txt</button>
            </div>

            <div id="progressText" class="hint"></div>

            <div id="transcript" class="transcript-area"></div>

            <div class="footer-note">
                First run will download all 3 models (~365MB total, cached in browser). This takes 3-5 minutes but only happens once. Subsequent visits load instantly.
            </div>
        </div>

        <div class="panel">
            <h2>Inputs</h2>

            <h3 style="font-size: 14px; margin-top: 0;">1. Upload audio file</h3>
            <div class="control-group">
                <input type="file" id="fileInput" accept="audio/*,video/*" style="display:none;">
                <button id="selectFileBtn" class="btn btn-primary">üìÅ Choose audio file</button>
            </div>
            <div class="control-group">
                <span id="fileName" class="hint">No file selected</span>
            </div>
            <div class="control-group">
                <button id="transcribeFileBtn" class="btn btn-secondary" disabled>‚ñ∂Ô∏è Transcribe file</button>
            </div>

            <hr style="margin: var(--space-16) 0; border: none; border-top: 1px solid rgba(0,0,0,0.06);" />

            <h3 style="font-size: 14px;">2. Experimental: capture screen/tab audio</h3>
            <p class="small-note">
                Works best in Chrome/Edge on desktop when you share a tab with "Share audio" enabled.
                Behavior varies by OS and browser. Treat this as experimental.
            </p>
            <div class="control-group">
                <button id="startShareBtn" class="btn btn-primary">üñ•Ô∏è Share screen/tab + audio</button>
                <button id="stopShareBtn" class="btn btn-danger" disabled>‚èπ Stop capture</button>
            </div>
            <p class="small-note">
                When you click "Share", choose the tab/window/screen that plays the audio you want, and enable audio sharing if offered.
            </p>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.2" id="transformers-script"></script>
<script>
    // Wait for transformers.js to load before loading app
    const transformersScript = document.getElementById('transformers-script');
    transformersScript.addEventListener('load', () => {
        console.log('Transformers.js script loaded');
        const appScript = document.createElement('script');
        appScript.src = 'js/app.js';
        document.body.appendChild(appScript);
    });
    transformersScript.addEventListener('error', () => {
        console.error('Failed to load transformers.js from CDN');
        document.getElementById('statusText').textContent = 'Failed to load library from CDN';
    });
</script>
</body>
</html>
